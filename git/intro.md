# 版本控制系统与 Git 简介

> Always use source code control.---Andrew Hunt 程序员修炼之道

本教程的首要目的，是使读者能用 Git 这个最流行的分布式版本控制系统管理自己的项目。本教程的另外一个目的，是让选修课程的同学能通过 Git 工具轻松获取课程的相关文件（代码、教案等）。

本教程并不能使你成为 Git 工具的专家，很多高级命令并不涉及，如果想进一步学习，请阅读 [《Pro Git》](http://git-scm.com/book/zh){{ "Scott-2009" | cite }}。

## Git 简介

### 什么是版本控制

什么是版本控制？我为什么要关心它呢？版本控制是一种记录一个或若干文件内容变化，以便将来查阅特定版本修订情况的系统。在本书所展示的例子中，我们仅对保存着软件源代码的文本文件作版本控制管理，但实际上，你可以对任何类型的文件进行版本控制。

如果你是位图形或网页设计师，可能会需要保存某一幅图片或页面布局文件的所有修订版本（这或许是你非常渴望拥有的功能）。采用版本控制系统（VCS）是个明智的选择。有了它你就可以将某个文件回溯到之前的状态，甚至将整个项目都回退到过去某个时间点的状态。你可以比较文件的变化细节，查出最后是谁修改了哪个地方，从而找出导致怪异问题出现的原因，又是谁在何时报告了某个功能缺陷等等。

使用版本控制系统通常还意味着，就算你乱来一气把整个项目中的文件改的改删的删，你也照样可以轻松恢复到原先的样子。但额外增加的工作量却微乎其微。

### 三种类型的版本控制系统

#### 本地版本控制系统

为了解决上面提到的问题，人们很久以前就开发了许多种本地版本控制系统，大多都是采用某种简单的数据库来记录文件的历次更新差异。

其中最流行的一种叫做 rcs，现今许多计算机系统上都还看得到它的踪影。甚至在流行的 Mac OS X 系统上安装了开发者工具包之后，也可以使用 rcs 命令。它的工作原理基本上就是保存并管理文件补丁（patch）。文件补丁是一种特定格式的文本文件，记录着对应文件修订前后的内容变化。所以，根据每次修订后的补丁，rcs 可以通过不断打补丁，计算出各个版本的文件内容。

#### 集中化的版本控制系统

接下来人们又遇到一个问题，如何让在不同系统上的开发者协同工作？于是，集中化的版本控制系统（ Centralized Version Control Systems，简称 CVCS ）应运而生。这类系统，诸如 CVS，Subversion 以及 Perforce 等，都有一个单一的集中管理的服务器，保存所有文件的修订版本，而协同工作的人们都通过客户端连到这台服务器，取出最新的文件或者提交更新。多年以来，这已成为版本控制系统的标准做法。

事分两面，有好有坏。这么做最显而易见的缺点是中央服务器的单点故障。如果宕机一小时，那么在这一小时内，谁都无法提交更新，也就无法协同工作。要是中央服务器的磁盘发生故障，碰巧没做备份，或者备份不够及时，就会有丢失数据的风险。最坏的情况是彻底丢失整个项目的所有历史更改记录，而被客户端偶然提取出来的保存在本地的某些快照数据就成了恢复数据的希望。但这样的话依然是个问题，你不能保证所有的数据都已经有人事先完整提取出来过。本地版本控制系统也存在类似问题，只要整个项目的历史记录被保存在单一位置，就有丢失所有历史更新记录的风险。

#### 分布式版本控制系统

于是分布式版本控制系统（ Distributed Version Control System，简称 DVCS ）面世了。在这类系统中，像 Git，Mercurial，Bazaar 以及 Darcs 等，客户端并不只提取最新版本的文件快照，而是把代码仓库完整地镜像下来。这么一来，任何一处协同工作用的服务器发生故障，事后都可以用任何一个镜像出来的本地仓库恢复。因为每一次的提取操作，实际上都是一次对代码仓库的完整备份。

#### 不同类型的管理工具对比

|       特征       | 本地版本控制系统 | 集中化版本控制系统 |                  分布式版本控制系统                  |
| ---------------- | ---------------- | ------------------ | ---------------------------------------------------- |
| 团队协作         | 无法团队协作     | 可团队协作         | 可团队协作                                           |
| 是否需要服务器   | 不需要           | 需要服务器         | 不需要服务器，但支持服务器，每个客户端都可以是服务器 |
| 是否支持复杂协作 | 不支持           | 仅支持团队内       | 即可团队内，也可小组内                               |

### Git 简史

同生活中的许多伟大事件一样，Git 诞生于一个极富纷争大举创新的年代。Linux 内核开源项目有着为数众广的参与者。绝大多数的 Linux 内核维护工作都花在了提交补丁和保存归档的繁琐事务上（1991－2002 年间）。到 2002 年，整个项目组开始启用分布式版本控制系统 BitKeeper 来管理和维护代码。

到了 2005 年，开发 BitKeeper 的商业公司同 Linux 内核开源社区的合作关系结束，他们收回了免费使用 BitKeeper 的权力。这就迫使 Linux 开源社区（特别是 Linux 的缔造者 Linus Torvalds ）不得不吸取教训，只有开发一套属于自己的版本控制系统才不至于重蹈覆辙。他们对新的系统制订了若干目标：

1. 速度
1. 简单的设计
1. 对非线性开发模式的强力支持（允许上千个并行开发的分支）
1. 完全分布式
1. 有能力高效管理类似 Linux 内核一样的超大规模项目（速度和数据量）

于是 Linus 花了两周时间自己用 C 写了一个分布式版本控制系统，这就是 Git。一个月之内，Linux 系统的源码已经由 Git 管理了！什么是大牛？大家可以体会一下。{{ "liaoxuefeng-2014" | cite }}

自诞生于 2005 年以来，Git 日臻成熟完善，在高度易用的同时，仍然保留着初期设定的目标。它的速度飞快，极其适合管理大项目，它还有着令人难以置信的非线性分支管理系统，可以应付各种复杂的项目开发需求。

Git 版本管理还有一点特别需要说明，就是它的分布式设计非常巧妙和高效，每一个安装了 Git 的计算机，既是服务端，又是客户端；既能在联网情况下使用，又能在断网的情况使用。

Git 迅速成为最流行的分布式版本控制系统，尤其是 2008 年，GitHub 网站上线了，它为开源项目免费提供 Git 存储，无数开源项目开始迁移至 GitHub，包括 Linux[^1]，jQuery，PHP，Ruby 等等，发展至今，GitHub 网站早已不再只是代码管理站点，已经成为程序员的交流学习的不可缺少的工具。

[^1]: <https://github.com/torvalds/linux，由大神 Linux Torvalds 管理。>
